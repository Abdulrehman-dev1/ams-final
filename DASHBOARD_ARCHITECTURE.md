# Dashboard Architecture Diagram

## ðŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER BROWSER                                 â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Dashboard View (index.blade.php)                          â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚  Sync Status Bar (Green/Yellow)                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  Last Sync: 5 min ago | Config: 09:30/10:00/19:00â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚  â”‚Widget1â”‚ â”‚Widget2â”‚ â”‚Widget3â”‚ â”‚Widget4â”‚  ROW 1          â”‚    â”‚
â”‚  â”‚  â”‚ ðŸ‘¥    â”‚ â”‚ â°    â”‚ â”‚ âœ…    â”‚ â”‚ âš ï¸    â”‚                 â”‚    â”‚
â”‚  â”‚  â”‚ 150   â”‚ â”‚ 85.5% â”‚ â”‚  128  â”‚ â”‚  22   â”‚                 â”‚    â”‚
â”‚  â”‚  â”‚[Info ]â”‚ â”‚[Info ]â”‚ â”‚[Info ]â”‚ â”‚[Info ]â”‚â† Click triggersâ”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚  â”‚Widget5â”‚ â”‚Widget6â”‚ â”‚Widget7â”‚ â”‚Widget8â”‚  ROW 2          â”‚    â”‚
â”‚  â”‚  â”‚ ðŸ“±    â”‚ â”‚ ðŸ’¾    â”‚ â”‚ ðŸ§¾    â”‚ â”‚ âŒ    â”‚                 â”‚    â”‚
â”‚  â”‚  â”‚  45   â”‚ â”‚  105  â”‚ â”‚   8   â”‚ â”‚   5   â”‚                 â”‚    â”‚
â”‚  â”‚  â”‚[Info ]â”‚ â”‚[Info ]â”‚ â”‚[Info ]â”‚ â”‚[Info ]â”‚                 â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚  â”‚Widget9â”‚ â”‚Widget10â”‚ â”‚Widget11â”‚ â”‚Widget12â”‚ ROW 3        â”‚    â”‚
â”‚  â”‚  â”‚ â±ï¸    â”‚ â”‚ â°     â”‚ â”‚ ðŸ“…     â”‚ â”‚ ðŸ’»     â”‚              â”‚    â”‚
â”‚  â”‚  â”‚09:15  â”‚ â”‚  12    â”‚ â”‚   3    â”‚ â”‚  5/5   â”‚              â”‚    â”‚
â”‚  â”‚  â”‚[Info ]â”‚ â”‚[Info ] â”‚ â”‚[Info ] â”‚ â”‚[Info ] â”‚              â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚  JavaScript Event Handlers                       â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  - Click listener on .widget-more-info          â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  - showWidgetDetails(widget)                    â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  - displayWidgetData(widget, data)              â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                       â”‚ AJAX Call                                  â”‚
â”‚                       â–¼                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ fetch('/api/dashboard/widgets/{widget}?date=X')
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LARAVEL BACKEND                                   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  routes/api.php                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Route::get('/api/dashboard/widgets/{widget}')          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   â†’ DashboardWidgetController@{method}                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                                       â”‚
â”‚                             â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  DashboardWidgetController                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ totalEmployees()     â†’ Query daily_employees          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ onTime()             â†’ Query acs_events               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ late()               â†’ Query acs_events               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ mobileCheckins()     â†’ Query acs_events (mobile)      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ deviceCheckins()     â†’ Query acs_events (device)      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ earlyLeave()         â†’ Query acs_events               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ absent()             â†’ Query acs_events + employees   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ overtime()           â†’ Query acs_events               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ pendingLeaves()      â†’ Query leaves                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ deviceStatus()       â†’ Query finger_devices           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  Helper Methods:                                             â”‚  â”‚
â”‚  â”‚  - buildSummaries()     - Group events by person            â”‚  â”‚
â”‚  â”‚  - cv()                 - Clean values                      â”‚  â”‚
â”‚  â”‚  - sourceFromEvent()    - Detect mobile vs device           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                                       â”‚
â”‚                             â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Database Queries                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ AcsEvent::whereBetween('occur_time_pk', [$start, $end])â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ DailyEmployee::whereNotNull('person_code')             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Leave::where('status', 0)                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ FingerDevices::all()                                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATABASE                                     â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  acs_events     â”‚  â”‚ daily_employees â”‚  â”‚  leaves          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ - person_code   â”‚  â”‚ - person_id     â”‚  â”‚ - emp_id         â”‚   â”‚
â”‚  â”‚ - occur_time_pk â”‚  â”‚ - person_code   â”‚  â”‚ - leave_date     â”‚   â”‚
â”‚  â”‚ - device_name   â”‚  â”‚ - full_name     â”‚  â”‚ - status         â”‚   â”‚
â”‚  â”‚ - card_number   â”‚  â”‚ - group_name    â”‚  â”‚ - type           â”‚   â”‚
â”‚  â”‚ - full_name     â”‚  â”‚ - phone         â”‚  â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚finger_devices   â”‚  â”‚  attendances    â”‚                          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚  â”‚ - name          â”‚  â”‚ - person_code   â”‚                          â”‚
â”‚  â”‚ - ip            â”‚  â”‚ - attendance_dateâ”‚                          â”‚
â”‚  â”‚ - serialNumber  â”‚  â”‚ - check_in_time â”‚                          â”‚
â”‚  â”‚                 â”‚  â”‚ - work_duration â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Data Flow Sequence

### Scenario: User clicks "More info" on Late widget

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ Browser  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Click "More info" on Late widget
     â”‚    data-widget="late"
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript         â”‚
â”‚  Event Handler      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. showWidgetDetails('late')
     â”‚    Swal.fire('Loading...')
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fetch API          â”‚
â”‚  (AJAX Call)        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. GET /api/dashboard/widgets/late?date=2025-10-17
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Laravel Router     â”‚
â”‚  (routes/api.php)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Route to DashboardWidgetController@late
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DashboardWidgetController   â”‚
â”‚  late() method               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. Parse date parameter
     â”‚    Get config (cutOffOnTime)
     â”‚    Build date range
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database Query     â”‚
â”‚  AcsEvent::...      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Fetch events for date range
     â”‚    whereBetween('occur_time_pk')
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  buildSummaries()   â”‚
â”‚  Helper Method      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 7. Group events by person
     â”‚    Detect first/last event
     â”‚    Identify source (mobile/device)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Filter Late        â”‚
â”‚  Logic              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 8. foreach summary:
     â”‚      if check_in > cutoff:
     â”‚        calculate late_minutes
     â”‚        add to $lateList
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Build JSON         â”‚
â”‚  Response           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 9. return response()->json([
     â”‚      'ok' => true,
     â”‚      'count' => 22,
     â”‚      'employees' => [...]
     â”‚    ])
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript         â”‚
â”‚  Callback           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 10. displayWidgetData('late', data)
     â”‚     Build HTML table
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SweetAlert Popup   â”‚
â”‚  Display            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 11. Show popup with table:
     â”‚     | Code | Name | Time | Late By |
     â”‚     |------|------|------|---------|
     â”‚     | 001  | John | 9:45 | 15 min  |
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚  Views   â”‚
â”‚  Data    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Configuration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   .env      â”‚
â”‚ File        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ATTENDANCE_ON_TIME_CUTOFF=09:30:00
       â”‚ ATTENDANCE_ABSENT_CUTOFF=10:00:00
       â”‚ ATTENDANCE_SHIFT_END_TIME=19:00:00
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ config/          â”‚
â”‚ attendance.php   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 'on_time_cutoff' => env('ATTENDANCE_ON_TIME_CUTOFF', '09:30:00')
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Config Cache    â”‚
â”‚ (after cache)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ php artisan config:cache
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AdminController         â”‚
â”‚  index() method          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ $cutOffOnTime = config('attendance.on_time_cutoff')
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Used in calculations    â”‚
â”‚  - On-time check         â”‚
       â”‚  - Late calculation      â”‚
â”‚  - Widget data           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Passed to view          â”‚
â”‚  $more['config'][...]    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Displayed in            â”‚
â”‚  Sync Status Bar         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¯ Widget Processing Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AdminController::index()                                    â”‚
â”‚                                                              â”‚
â”‚  1. Load Configuration                                       â”‚
â”‚     â”œâ”€ $cutOffOnTime  = config('attendance.on_time_cutoff')â”‚
â”‚     â”œâ”€ $absentCutTime = config('attendance.absent_cutoff') â”‚
â”‚     â””â”€ $shiftOffTime  = config('attendance.shift_end_time')â”‚
â”‚                                                              â”‚
â”‚  2. Determine Focus Date                                     â”‚
â”‚     â”œâ”€ Check request('date')                                â”‚
â”‚     â”œâ”€ Default to today                                     â”‚
â”‚     â””â”€ Fallback to latest ACS event date                   â”‚
â”‚                                                              â”‚
â”‚  3. Query ACS Events                                         â”‚
â”‚     â””â”€ AcsEvent::whereBetween('occur_time_pk')             â”‚
â”‚        â”œâ”€ Start: focus_date 00:00:00                       â”‚
â”‚        â””â”€ End: focus_date 23:59:59                         â”‚
â”‚                                                              â”‚
â”‚  4. Build Person Summaries                                   â”‚
â”‚     â””â”€ Group events by:                                     â”‚
â”‚        â”œâ”€ person_code (preferred)                          â”‚
â”‚        â”œâ”€ card_number (fallback)                           â”‚
â”‚        â”œâ”€ name (fallback)                                  â”‚
â”‚        â””â”€ record_guid (last resort)                        â”‚
â”‚                                                              â”‚
â”‚  5. Extract First/Last Events                                â”‚
â”‚     â”œâ”€ $first = earliest event per person                  â”‚
â”‚     â””â”€ $last = latest event per person                     â”‚
â”‚                                                              â”‚
â”‚  6. Detect Source (Mobile vs Device)                         â”‚
â”‚     â””â”€ sourceFromEvent()                                    â”‚
â”‚        â”œâ”€ Check device_name contains 'mobile'/'app'        â”‚
â”‚        â”œâ”€ Check card_reader_name contains 'mobile'/'app'   â”‚
â”‚        â”œâ”€ â†’ Mobile if match                                â”‚
â”‚        â””â”€ â†’ Device otherwise                               â”‚
â”‚                                                              â”‚
â”‚  7. Calculate Metrics                                        â”‚
â”‚     â”œâ”€ On-time: first â‰¤ cutOffOnTime                       â”‚
â”‚     â”œâ”€ Late: first > cutOffOnTime                          â”‚
â”‚     â”œâ”€ Mobile: source === 'Mobile'                         â”‚
â”‚     â”œâ”€ Device: source === 'Device'                         â”‚
â”‚     â”œâ”€ Early Leave: last < shiftOffTime                    â”‚
â”‚     â””â”€ Overtime: last > shiftOffTime                       â”‚
â”‚                                                              â”‚
â”‚  8. Calculate Absent                                         â”‚
â”‚     â””â”€ If current time > absentCutTime:                    â”‚
â”‚        â”œâ”€ $allEmployees = DailyEmployee::count()           â”‚
â”‚        â”œâ”€ $presentByTen = count(arrivals â‰¤ 10:00)         â”‚
â”‚        â””â”€ $absent = $allEmployees - $presentByTen         â”‚
â”‚                                                              â”‚
â”‚  9. Calculate Additional Widgets                             â”‚
â”‚     â”œâ”€ Average check-in: SUM(minutes) / COUNT              â”‚
â”‚     â”œâ”€ Pending leaves: Leave::where('status', 0)          â”‚
â”‚     â””â”€ Device status: FingerDevices::count()              â”‚
â”‚                                                              â”‚
â”‚  10. Build Response Arrays                                   â”‚
â”‚      â”œâ”€ $data = [total, onTime, late, onTimePct]          â”‚
â”‚      â””â”€ $more = [mobile, device, early, absent, ...]      â”‚
â”‚                                                              â”‚
â”‚  11. Pass to View                                            â”‚
â”‚      â””â”€ view('admin.index', compact('data', 'more'))      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ” API Endpoint Logic

```
DashboardWidgetController Methods:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Common Flow for All Widget Endpoints:                   â”‚
â”‚                                                           â”‚
â”‚  1. Parse Request                                         â”‚
â”‚     â”œâ”€ Get date parameter (default: today)               â”‚
â”‚     â””â”€ Get config values                                 â”‚
â”‚                                                           â”‚
â”‚  2. Build Date Range                                      â”‚
â”‚     â”œâ”€ $start = Carbon::parse($date)->startOfDay()       â”‚
â”‚     â””â”€ $end = Carbon::parse($date)->endOfDay()           â”‚
â”‚                                                           â”‚
â”‚  3. Query Database                                        â”‚
â”‚     â””â”€ AcsEvent::whereBetween('occur_time_pk')           â”‚
â”‚                                                           â”‚
â”‚  4. Build Summaries                                       â”‚
â”‚     â””â”€ buildSummaries($events, $tz)                      â”‚
â”‚        â”œâ”€ Group by person                                â”‚
â”‚        â”œâ”€ Get first/last events                          â”‚
â”‚        â””â”€ Detect source                                  â”‚
â”‚                                                           â”‚
â”‚  5. Filter Data                                           â”‚
â”‚     â””â”€ Apply widget-specific filter:                     â”‚
â”‚        â”œâ”€ onTime(): check_in â‰¤ cutoff                    â”‚
â”‚        â”œâ”€ late(): check_in > cutoff                      â”‚
â”‚        â”œâ”€ mobile(): source === 'Mobile'                  â”‚
â”‚        â”œâ”€ device(): source === 'Device'                  â”‚
â”‚        â”œâ”€ early(): check_out < shift_end                 â”‚
â”‚        â”œâ”€ overtime(): check_out > shift_end              â”‚
â”‚        â””â”€ absent(): not in present list                  â”‚
â”‚                                                           â”‚
â”‚  6. Format Response                                       â”‚
â”‚     â””â”€ Build array with:                                 â”‚
â”‚        â”œâ”€ person_code                                    â”‚
â”‚        â”œâ”€ name                                           â”‚
â”‚        â”œâ”€ time                                           â”‚
â”‚        â”œâ”€ calculated value (late_by, overtime, etc.)     â”‚
â”‚        â””â”€ source/device                                  â”‚
â”‚                                                           â”‚
â”‚  7. Return JSON                                           â”‚
â”‚     â””â”€ response()->json([                                â”‚
â”‚          'ok' => true,                                   â”‚
â”‚          'count' => X,                                   â”‚
â”‚          'employees' => [...]                            â”‚
â”‚        ])                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¨ Frontend JavaScript Flow

```javascript
// Event Binding
document.querySelectorAll('.widget-more-info')
  .forEach(el => el.addEventListener('click', handleClick));

// Click Handler
function handleClick(e) {
  widget = this.getAttribute('data-widget');
  showWidgetDetails(widget);
}

// Show Widget Details
function showWidgetDetails(widget) {
  // 1. Show loading
  Swal.fire({
    title: 'Loading...',
    showConfirmButton: false,
    willOpen: () => Swal.showLoading()
  });
  
  // 2. Fetch from API
  fetch(`/api/dashboard/widgets/${widget}?date=${FOCUS_DATE}`)
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        displayWidgetData(widget, data);
      }
    });
}

// Display Widget Data
function displayWidgetData(widget, data) {
  // 1. Build HTML table based on widget type
  html = buildTable(widget, data);
  
  // 2. Show SweetAlert popup
  Swal.fire({
    title: getTitle(widget, data),
    html: html,
    width: '800px',
    showCloseButton: true
  });
}
```

---

## ðŸ“¦ File Structure

```
project/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ attendance.php              â† Configuration file
â”‚
â”œâ”€â”€ app/
â”‚   â””â”€â”€ Http/
â”‚       â””â”€â”€ Controllers/
â”‚           â”œâ”€â”€ AdminController.php             â† Dashboard data
â”‚           â””â”€â”€ DashboardWidgetController.php   â† API endpoints
â”‚
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ api.php                     â† Widget API routes
â”‚
â”œâ”€â”€ resources/
â”‚   â””â”€â”€ views/
â”‚       â””â”€â”€ admin/
â”‚           â””â”€â”€ index.blade.php     â† Dashboard view
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ DASHBOARD_IMPROVEMENTS.md   â† Full documentation
    â”œâ”€â”€ WIDGET_QUICK_REFERENCE.md   â† Quick reference
    â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md   â† Implementation summary
    â””â”€â”€ DASHBOARD_ARCHITECTURE.md   â† This file
```

---

## ðŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Public Access   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Authentication    â”‚
â”‚  Middleware        â”‚  â† Should be added to API routes
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Role Middleware   â”‚
â”‚  (Admin only)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller        â”‚
â”‚  Authorization     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Access       â”‚
â”‚  (Eloquent ORM)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Recommended route protection:**
```php
Route::prefix('dashboard/widgets')
    ->middleware(['auth', 'role:admin'])
    ->group(function () {
        // ... widget routes
    });
```

---

**End of Architecture Documentation**


